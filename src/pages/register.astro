---
import '../styles.css';
---
<html>
  <head><meta charset="utf-8"><title>Register</title></head>
  <body>
    <div class="container">
      <div class="card">
        <h2>Register</h2>
        <label>Email</label><input id="email" type="email" />
        <label>Password</label><input id="password" type="password" />
        <button class="btn" id="btn">Register</button>
        <p id="msg" class="small"></p>
      </div>
    </div>

    <script>
      document.getElementById('btn').addEventListener('click', async ()=>{
        const email = document.getElementById('email').value;
        const pw = document.getElementById('password').value;
        if(!email||!pw){document.getElementById('msg').textContent='Enter email & password'; return;}
        // Hash password client-side (SHA-256) then send plain hash (server stores hash of plaintext that is SHA-256 of password)
        const enc = new TextEncoder();
        const h = await crypto.subtle.digest('SHA-256', enc.encode(pw));
        const hashB64 = btoa(String.fromCharCode(...new Uint8Array(h)));
        const res = await fetch('/api/register',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email, password_hash: hashB64})});
        const j = await res.json();
        if(res.ok && j.ok) { alert('Registered. Please login'); window.location='/login'; }
        else document.getElementById('msg').textContent = j.error || 'Registration failed';
      });
    </script>
  </body>
</html>
