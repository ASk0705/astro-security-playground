---
import '../styles.css';
---
<html>
  <head><meta charset="utf-8"><title>Stats</title></head>
  <body>
    <div class="container">
      <div class="card">
        <h2>Traffic Stats</h2>
        <div id="stats" class="small">Loading...</div>
        <canvas id="c" width="600" height="120" style="border:1px solid #eee;margin-top:12px"></canvas>
      </div>
    </div>

    <script>
      async function load(){
        const r = await fetch('/api/stats');
        const j = await r.json();
        document.getElementById('stats').innerText = JSON.stringify(j, null, 2);
        const data = j.history || [];
        const c = document.getElementById('c'); const ctx = c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height);
        if(data.length===0) return;
        const max = Math.max(...data);
        data.forEach((v,i)=>{
          const x = i*(c.width/data.length);
          const y = c.height - (v/max)*(c.height-10);
          ctx.fillRect(x, y, 4, c.height - y);
        });
      }
      setInterval(load, 2000);
      load();
    </script>
  </body>
</html>
